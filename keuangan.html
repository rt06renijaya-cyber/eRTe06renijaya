<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Laporan Keuangan RT 06 Reni Jaya</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: "Inter", sans-serif;
        background: #f4f6f8;
        margin: 0;
        padding: 0;
        color: #333;
    }
    header {
        padding: 24px;
        background: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 24px;
        text-align: center;
    }
    h1 {
        font-size: 28px;
        font-weight: 700;
        margin: 0;
    }
    .container {
        width: 95%;
        max-width: 1100px;
        margin: auto;
    }
    .card {
        background: white;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        margin-bottom: 24px;
    }
    .summary-item {
        font-size: 18px;
        margin: 8px 0;
    }
    .summary-item b {
        font-weight: 700;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 14px;
    }
    th, td {
        padding: 12px;
        border-bottom: 1px solid #e3e3e3;
        text-align: left;
    }
    th {
        background: #f1f1f1;
        font-weight: 600;
    }
    tr:hover {
        background: #fafafa;
    }

    .chart-wrapper {
        width: 100%;
        margin-top: 20px;
    }

    @media only screen and (max-width: 600px) {
        h1 { font-size: 22px; }
        table { font-size: 12px; }
        th, td { padding: 8px; }
    }
</style>
</head>

<body>

<header>
    <h1>Laporan Keuangan RT 06 Reni Jaya</h1>
</header>

<div class="container">

    <!-- Summary Card -->
    <div class="card">
        <div class="summary-item"><b>Total Pemasukan:</b> <span id="totalIn">Rp0</span></div>
        <div class="summary-item"><b>Total Pengeluaran:</b> <span id="totalOut">Rp0</span></div>
        <div class="summary-item"><b>Saldo Akhir:</b> <span id="saldo">Rp0</span></div>
    </div>

    <!-- Pie Chart -->
    <div class="card">
        <h3>Grafik Pemasukan vs Pengeluaran</h3>
        <canvas id="pieChart"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="card">
        <h3>Perkembangan Saldo Bulanan</h3>
        <canvas id="barChart"></canvas>
    </div>

    <!-- Table Pemasukan -->
    <div class="card">
        <h2>Data Pemasukan</h2>
        <table id="tabelMasuk">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Jumlah</th>
                    <th>Keterangan</th>
                    <th>Kategori</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Table Pengeluaran -->
    <div class="card">
        <h2>Data Pengeluaran</h2>
        <table id="tabelKeluar">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Jumlah</th>
                    <th>Keperluan</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script>
// ============= GOOGLE SHEET API ==============
const SHEET_URL =
"https://docs.google.com/spreadsheets/d/1EMYpie82paCl-vupfhyj11Z9tNGFp2p7aIDwIIl_Z0o/gviz/tq?tqx=out:json";

// Fetch Data
async function ambilData() {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const json = JSON.parse(text.substring(47, text.length - 2));

    const rows = json.table.rows.map(r => r.c.map(c => c?.v ?? ""));

    prosesData(rows);
}

function formatRupiah(n) {
    return "Rp" + n.toLocaleString("id-ID");
}

function prosesData(rows) {
    let totalMasuk = 0;
    let totalKeluar = 0;

    const masukTbody = document.querySelector("#tabelMasuk tbody");
    const keluarTbody = document.querySelector("#tabelKeluar tbody");

    rows.forEach(r => {
        let jenis = r[3];
        let jumlah = Number(r[1]) || 0;

        if (jenis === "Masuk") {
            totalMasuk += jumlah;
            masukTbody.innerHTML += `
                <tr>
                    <td>${r[0]}</td>
                    <td>${formatRupiah(jumlah)}</td>
                    <td>${r[2]}</td>
                    <td>${r[4]}</td>
                </tr>`;
        }

        if (jenis === "Keluar") {
            totalKeluar += jumlah;
            keluarTbody.innerHTML += `
                <tr>
                    <td>${r[0]}</td>
                    <td>${formatRupiah(jumlah)}</td>
                    <td>${r[2]}</td>
                </tr>`;
        }
    });

    let saldoAkhir = totalMasuk - totalKeluar;

    document.getElementById("totalIn").innerText = formatRupiah(totalMasuk);
    document.getElementById("totalOut").innerText = formatRupiah(totalKeluar);
    document.getElementById("saldo").innerText = formatRupiah(saldoAkhir);

    gambarChart(totalMasuk, totalKeluar);
}

function gambarChart(masuk, keluar) {
    new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
            labels: ["Pemasukan", "Pengeluaran"],
            datasets: [{
                data: [masuk, keluar],
                backgroundColor: ["#4CAF50", "#F44336"]
            }]
        }
    });

    new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
            labels: ["Saldo"],
            datasets: [{
                label: "Saldo Akhir",
                data: [masuk - keluar],
                backgroundColor: "#2196F3"
            }]
        }
    });
}

ambilData();
</script>

</body>
</html>
