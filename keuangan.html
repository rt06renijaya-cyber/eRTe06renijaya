<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan RT 06</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

    body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        background: #f5f8fc;
        color: #333;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 16px;
    }

    .card {
        background: white;
        border-radius: 16px;
        padding: 18px;
        margin-bottom: 20px;
        box-shadow: 0px 4px 20px rgba(0,0,0,0.05);
    }

    h2 {
        font-size: 20px;
        text-align: center;
        margin: 0 0 16px;
        font-weight: 700;
        color: #2c3e50;
    }

    /* CHART RESPONSIVE */
    .chart-container {
        width: 100%;
        height: 320px;
        position: relative;
    }

    canvas {
        width: 100% !important;
        height: 100% !important;
    }

    /* =======================
       MOBILE (<480px)
    =========================*/
    @media (max-width: 480px) {

        .container {
            padding: 10px;
        }

        h2 {
            font-size: 16px;
        }

        .card {
            padding: 14px;
            border-radius: 14px;
        }

        .chart-container {
            height: 220px !important; /* ukuran ideal di HP */
        }

        .chart-container canvas {
            height: 220px !important;
        }

        body {
            font-size: 13px;
        }
    }
    </style>
</head>

<body>

<div class="container">

    <div class="card">
        <h2>Grafik Pemasukan & Pengeluaran per Kategori</h2>
        <div class="chart-container">
            <canvas id="kategoriChart"></canvas>
        </div>
    </div>

</div>

<script>
const SHEET_URL_PEMASUKAN =
 "https://opensheet.elk.sh/1EMYpie82paCl-vupfhyj11Z9tNGFp2p7aIDwIIl_Z0o/web_Pemasukan";

const SHEET_URL_PENGELUARAN =
 "https://opensheet.elk.sh/1EMYpie82paCl-vupfhyj11Z9tNGFp2p7aIDwIIl_Z0o/web_Pengeluaran";

async function ambilData() {
    const [pemasukanRes, pengeluaranRes] = await Promise.all([
        fetch(SHEET_URL_PEMASUKAN),
        fetch(SHEET_URL_PENGELUARAN)
    ]);

    const pemasukan = await pemasukanRes.json();
    const pengeluaran = await pengeluaranRes.json();

    const totalMasuk = {};
    const totalKeluar = {};

    pemasukan.forEach(row => {
        const kategori = row.Kategori?.trim();
        const nominal = parseInt(row.Nominal || "0");
        if (kategori) totalMasuk[kategori] = (totalMasuk[kategori] || 0) + nominal;
    });

    pengeluaran.forEach(row => {
        const kategori = row.Kategori?.trim();
        const nominal = parseInt(row.Nominal || "0");
        if (kategori) totalKeluar[kategori] = (totalKeluar[kategori] || 0) + nominal;
    });

    const semuaKategori = Array.from(new Set([
        ...Object.keys(totalMasuk),
        ...Object.keys(totalKeluar)
    ])).sort();

    const dataMasuk = semuaKategori.map(k => totalMasuk[k] || 0);
    const dataKeluar = semuaKategori.map(k => totalKeluar[k] || 0);

    buatChart(semuaKategori, dataMasuk, dataKeluar);
}

function buatChart(labels, masuk, keluar) {
    const ctx = document.getElementById("kategoriChart");

    new Chart(ctx, {
        type: "line",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Pemasukan",
                    data: masuk,
                    borderColor: "#2ecc71",
                    backgroundColor: "rgba(46,204,113,0.18)",
                    borderWidth: 3,
                    tension: 0.4,
                    pointRadius: 3
                },
                {
                    label: "Pengeluaran",
                    data: keluar,
                    borderColor: "#e74c3c",
                    backgroundColor: "rgba(231,76,60,0.18)",
                    borderWidth: 3,
                    tension: 0.4,
                    pointRadius: 3
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: "top" }
            },
            scales: {
                x: {
                    ticks: {
                        maxRotation: 60,
                        minRotation: 0,
                        font: { size: 10 }   // lebih kecil di HP
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        font: { size: 10 }   // lebih kecil
                    }
                }
            }
        }
    });
}

ambilData();
</script>

</body>
</html>
